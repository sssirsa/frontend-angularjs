<div class="bg-01"
     cg-busy="{promise:vm.loadingPromise && vm.loadingPromise2,templateUrl:'app/mainApp/directives/loading_repeater.tmpl.html',wrapperClass:'cg-busy cg-busy-animation'}"
     layout="column">

    <md-card layout="column" layout-align="center stretch" layout-gt-sm="row" layout-align-gt-sm="space-around center" layout-padding>
        <h2 translate>SALEPOINT_REQUEST.ASSIGN_DETAIL.TITLE</h2>

        <md-content>
            <div layout="row">
                <div layout="column" layout-align="center center">
                    <b translate>Folio</b>
                </div>
                <div layout="column" layout-align="center center">
                    <b>:&nbsp</b>
                </div>
                <div layout="column" layout-align="center center">
                    {{vm.request.folio}}
                </div>
            </div>

            <div>
                <div layout="row">
                    <div layout="column" layout-align="center center">
                        <b translate>TÃ©cnico asignado</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        {{vm.user.nombre+' '+vm.user.apellido_paterno+' '+vm.user.apellido_materno}}
                    </div>
                </div>
            </div>

            <div>
                <div layout="row">
                    <div layout="column" layout-align="center center">
                        <b translate>Tipo</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        {{vm.request.tipo}}
                    </div>
                </div>
            </div>

            <div>
                <div layout="row">

                    <div layout="column" layout-align="center center">
                        <b translate>Status</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>

                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Abierta'">
                        <div layout="row">
                            <span translate>PRE_REQUEST.LIST.TYPE.OPEN</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Abierta"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'En_proceso'">
                        <div layout="row">
                            <span translate>PRE_REQUEST.LIST.TYPE.IN_PROCESS</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="En_proceso"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Atendida'">
                        <div layout="row">
                            <span translate>PRE_REQUEST.LIST.TYPE.ATTENDED</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Atendida"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Cancelada'">
                        <div layout="row">
                            <span translate>PRE_REQUEST.LIST.TYPE.CANCELED</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Cancelada"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Improductiva'">
                        <div layout="row">
                            <span translate>PRE_REQUEST.LIST.TYPE.UNPRODUCTIVE</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Improductiva"></div>
                        </div>
                    </div>
                </div>
            </div>
        </md-content>

    </md-card>

    <md-card
        layout="column"
        layout-align="center stretch"
        cg-busy="{promise:vm.storeLoading,templateUrl:'app/mainApp/directives/loading_repeater.tmpl.html',wrapperClass:'cg-busy cg-busy-animation'}"
        layout-padding>
        <h3 translate>SALEPOINT_REQUEST.ASSIGN_DETAIL.STORE</h3>

        <store-manager
            store="vm.store"
        ></store-manager>

    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             layout-padding>
        <h3 translate>REQUEST.EVIDENCES.TITLE</h3>

        <div
            layout="column"
            layout-align="space-around center">

            <div ng-if="vm.solicitudDetalles.evidencia.length > 0" layout-fill>

                <ng-image-gallery
                    images="vm.solicitudDetalles.evidencia"
                    thumbnails="false"
                    thumb-size="80"
                    inline="true"
                    bubbles="true"
                    bubble-size="5"
                    img-bubbles="true"
                    bg-close="false"
                    piracy="false"
                    img-anim="fadeup"
                ></ng-image-gallery>
                <!--<img ng-repeat="evidence in vm.request.evidencia" ngf-src="evidence.foto" class="thumbnails" layout-padding/>-->
            </div>

            <div ng-if="vm.solicitudDetalles.evidencia.length === 0">
                <p>{{'REQUEST.DETAIL.NO_EVIDENCES'|translate}}</p>
            </div>
        </div>
    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             layout-padding
             ng-if="!vm.visible">
        <h3 translate>ATTENTION.EVIDENCE.TITLE</h3>

        <div
            layout="column"
            layout-align="space-around center">

            <div ng-if="vm.request.evidencia.length > 0" layout-fill>

                <ng-image-gallery
                    images="vm.request.evidencia"
                    thumbnails="false"
                    thumb-size="80"
                    inline="true"
                    bubbles="true"
                    bubble-size="5"
                    img-bubbles="true"
                    bg-close="false"
                    piracy="false"
                    img-anim="fadeup"
                ></ng-image-gallery>
                <!--<img ng-repeat="evidence in vm.request.evidencia" ngf-src="evidence.foto" class="thumbnails" layout-padding/>-->
            </div>

            <div ng-if="vm.request.evidencia.length===0">
                <p>{{'REQUEST.EVIDENCES.NO_EVIDENCES'|translate}}</p>
            </div>
        </div>
    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             layout-padding>
        <h3 translate>Servicio</h3>

        <md-input-container class="md-block">
            <input ng-model="vm.km" type="text" placeholder="km (required)"
                   ng-required="true" maxlength="6" ng-disabled="!vm.visible" only-digits>
        </md-input-container>

        <md-input-container class="md-block" layout-padding>

            <div layout="colum" layout-align="left center" ng-if="vm.request.tipo === 'Cambio'">
                Cambiar Cabinet:&nbsp
            </div>
            <div layout="colum" layout-align="left center">
                <input ng-model="vm.solicitudDetalles.cabinet" readonly>
            </div>

        </md-input-container>

        <div layout-align="center stretch"
             layout="column"
             layout-padding>

            <div  flex class="md-block">
                <table md-table flex>
                    <thead md-head>
                    <tr md-row>
                        <th md-column>
                            <span translate>REQUEST.CABINET.KIND</span>
                        </th>
                        <th md-column>
                            <span translate>REQUEST.CABINET.QUANTITY</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody md-body>
                    <tr md-row
                        ng-repeat="cabinet in vm.solicitudDetalles.cabinets_solicitud">
                        <td md-cell>{{cabinet.tipo}}</td>
                        <td md-cell>{{cabinet.cantidad}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- nuevo cabinet -->
            <md-content layout="column" layout-align="center stretch" layout-padding ng-if="vm.visible">

                <div layout="row" layout-align="space-around center" layout-padding="" ng-if="!vm.searchBool">
                    <form ng-submit="vm.searchCabinet()" flex="80" class="md-block">
                        <md-input-container
                            flex="80"
                            class="md-block">
                            <label>{{'MAIN.COMPONENTS.CABINET.SEARCH_BY_ECONOMIC'|translate}}</label>
                            <input
                                only-digits
                                ng-model="vm.searchText">
                        </md-input-container>
                    </form>
                </div>

                <div flex="40" ng-if="vm.searchBool">
                    <md-toolbar layout="column"
                                layout-gt-sm="row"
                                layout-align="center stretch"
                                layout-align-gt-sm="space-between center">
                        <div layout="row" layout-align="center center">
                            <span class="md-subtitle">{{'MAIN.COMPONENTS.CABINET.SEARCH_BY_ECONOMIC'|translate}}</span>
                        </div>
                        <div layout="column"
                             layout-align="center stretch">
                            <md-button aria-label="'Remove filter'"
                                       ng-click="vm.removeFilter()"
                                       class="md-raised">
                                <md-icon md-font-icon="fa fa-ban"></md-icon>
                                {{'MAIN.COMPONENTS.CABINET.REMOVE_FILTER'|translate}}
                            </md-button>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-align="center center">
                        <span class="md-subtitle">{{'MAIN.COMPONENTS.CABINET.SEARCHED_ITEM'|translate}}:</span>&nbsp
                        <span class="md-subtitle">{{vm.searchText}}</span>
                    </div>
                </div>

                <div ng-if="vm.todos.length > 0">
                    <md-list-item class="md-3-line" ng-repeat="item in vm.todos"">
                    <img ng-src="{{item.qr_code}}" class="qr-icon" alt="{{item.economico}}" />

                    <div flex="100" layout="column" layout-gt-sm="row" layout-align="space-between center">
                        <div layout="column" layout-align="start center">
                            <div class="md-list-item-text" layout="column">
                                <h2>EconÃ³mico: {{ item.economico }}</h2>
                                <h3>Modelo: {{ item.modelo }}</h3>
                                <h4>NÃºmero de Serie: {{ item.no_serie }}</h4>
                                <p>Estado: {{ item.estado }}</p>
                            </div>
                        </div>
                    </div>

                    <md-divider></md-divider>
                    </md-list-item>
                </div>

                <div ng-if="vm.todos.length == 0 && vm.searchBool">
                    <md-button aria-label="'Crear cabinet'"
                               ng-click="vm.createCabinet(vm.searchText)"
                               class="md-raised">
                        <md-icon md-font-icon="fa fa-plus"></md-icon>
                        {{'MAIN.COMPONENTS.CABINET.CREATE'|translate}}: {{vm.searchText}}
                    </md-button>
                </div>
            </md-content>
            <!-- fin -->
        </div>

    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             ng-if="vm.request.tipo && vm.visible"
             layout-padding>
        <div flex
             layout="row"
             layout-align-gt-sm="space-around center">
            <h3 translate>ATTENTION.EVIDENCE.TITLE</h3>
        </div>
        <file-uploader file-formats="'image/*'"
                       validations="vm.fileValidations"
                       allow-folders="true"
                       max-files="5"
                       multiple-files="true"
                       keep="true"
                       files-selected="vm.filesSelected(files,1)"
        ></file-uploader>
    </md-card>

    <md-card layout-align="space-around center"
             layout="row"
             ng-if="vm.request.tipo && vm.visible"
             layout-padding>
        <div flex-gt-sm="50" flex="100">
            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center">
                <h3 translate>ATTENTION.EVIDENCE.FIRM_CLIENT</h3>
            </div>
            <file-uploader file-formats="'image/*'"
                           validations="vm.fileValidations"
                           allow-folders="false"
                           max-files="1"
                           multiple-files="false"
                           keep="true"
                           files-selected="vm.filesSelected(files,2)">
            </file-uploader>
        </div>
        <div flex-gt-sm="50" flex="100">
            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center">
                <h3 translate>ATTENTION.EVIDENCE.FIRM_TECHNICAL</h3>
            </div>
            <file-uploader file-formats="'image/*'"
                           validations="vm.fileValidations"
                           allow-folders="false"
                           max-files="1"
                           multiple-files="false"
                           keep="true"
                           files-selected="vm.filesSelected(files,3)"
            ></file-uploader>
        </div>
    </md-card>

    <md-card layout-align="space-around center"
             layout="row"
             ng-if="!vm.visible"
             layout-padding>
        <div flex-gt-sm="50" flex="100">
            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center">
                <h3 translate>ATTENTION.EVIDENCE.FIRM_CLIENT</h3>
            </div>

            <div ng-if="vm.request.firma_cliente" layout-fill>

                <ng-image-gallery
                    images="vm.request.firma_cliente"
                    thumbnails="false"
                    thumb-size="80"
                    inline="true"
                    bubbles="true"
                    bubble-size="5"
                    img-bubbles="true"
                    bg-close="false"
                    piracy="false"
                    img-anim="fadeup"
                ></ng-image-gallery>
                <!--<img ng-repeat="evidence in vm.request.evidencia" ngf-src="evidence.foto" class="thumbnails" layout-padding/>-->
            </div>

            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center" ng-if="!vm.request.firma_cliente">
                <p>{{'ATTENTION.EVIDENCE.NO_FIRM'|translate}}</p>
            </div>

        </div>
        <div flex-gt-sm="50" flex="100">
            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center">
                <h3 translate>ATTENTION.EVIDENCE.FIRM_TECHNICAL</h3>
            </div>

            <div ng-if="vm.request.firma_tecnico" layout-fill>

                <ng-image-gallery
                    images="vm.request.firma_tecnico"
                    thumbnails="false"
                    thumb-size="80"
                    inline="true"
                    bubbles="true"
                    bubble-size="5"
                    img-bubbles="true"
                    bg-close="false"
                    piracy="false"
                    img-anim="fadeup"
                ></ng-image-gallery>
                <!--<img ng-repeat="evidence in vm.request.evidencia" ngf-src="evidence.foto" class="thumbnails" layout-padding/>-->
            </div>

            <div flex
                 layout="row"
                 layout-align-gt-sm="space-around center"
                 ng-if="!vm.request.firma_tecnico">
                <p>{{'ATTENTION.EVIDENCE.NO_FIRM'|translate}}</p>
            </div>

        </div>
    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             ng-if="vm.request.tipo"
             layout-padding>
        <div flex
             layout="row"
             layout-align-gt-sm="space-around center">
            <h3 translate>ATTENTION.EVIDENCE.INFO_ATENTTION</h3>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">
            <md-input-container flex class="md-block">
                <label translate>ATTENTION.EVIDENCE.CLIENT_COMMENTS</label>
                <input
                    ng-model="vm.request.observaciones_cliente"
                    ng-disabled="!vm.visible"/>
            </md-input-container>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">
            <md-input-container flex class="md-block">
                <label translate>ATTENTION.EVIDENCE.TECHNICAL_COMMENTS</label>
                <input
                    ng-model="vm.request.observaciones_tecnico"
                    ng-disabled="!vm.visible"/>
            </md-input-container>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">

            <md-input-container flex class="md-block">
                <label translate>ATTENTION.EVIDENCE.SCORE</label>
                <md-select
                    ng-model="vm.request.calificacion"
                    ng-disabled="!vm.visible">
                    <md-option
                        ng-repeat="score in vm.scores"
                        ng-value="score.value">
                        {{score.label}}
                    </md-option>
                </md-select>
            </md-input-container>
        </div>

        <div layout="row"
             layout-align="end end"
             layout-sm="column"
             layout-xs="column"
             layout-align-sm="start stretch"
             layout-align-xs="start stretch"
             ng-if="vm.visible"
             cg-busy="{promise:vm.promiseLoader,templateUrl:'app/mainApp/directives/loading_repeater.tmpl.html',wrapperClass:'cg-busy cg-busy-animation'}">
            <md-button
                cg-busy="{promise:vm.savingPromise, message:''}"
                aria-label="assign" ng-click="vm.enviar()"
                class="md-raised md-primary">
                <md-icon md-font-icon="fa fa-save"></md-icon>
            </md-button>
        </div>

    </md-card>

</div>
