<div class="bg-01"
     cg-busy="{promise:vm.loadingPromise,templateUrl:'app/mainApp/directives/loading_repeater.tmpl.html',wrapperClass:'cg-busy cg-busy-animation'}"
     layout="column">

    <md-card layout="column" layout-align="center stretch" layout-gt-sm="row" layout-align-gt-sm="space-around center" layout-padding>
        <h2 translate>SALEPOINT_REQUEST.ASSIGN_DETAIL.TITLE</h2>

        <md-content>
            <div layout="row">
                <div layout="column" layout-align="center center">
                    <b translate>Folio</b>
                </div>
                <div layout="column" layout-align="center center">
                    <b>:&nbsp</b>
                </div>
                <div layout="column" layout-align="center center">
                    {{vm.request.folio}}
                </div>
            </div>

            <div>
                <div layout="row">
                    <div layout="column" layout-align="center center">
                        <b translate>Técnico asignado</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        {{vm.user.nombre+' '+vm.user.apellido_paterno+' '+vm.user.apellido_materno}}
                    </div>
                </div>
            </div>

            <div>
                <div layout="row">
                    <div layout="column" layout-align="center center">
                        <b translate>Tipo</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        {{vm.request.tipo}}
                    </div>
                </div>
            </div>

            <div>
                <div layout="row">

                    <div layout="column" layout-align="center center">
                        <b translate>Status</b>
                    </div>
                    <div layout="column" layout-align="center center">
                        <b>:&nbsp</b>
                    </div>

                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Abierta'">
                        <div layout="row">
                            <span translate>REQUESTS.LIST.OPEN</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Abierta"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'En_proceso'">
                        <div layout="row">
                            <span translate>REQUESTS.LIST.IN_PROCESS</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="En_proceso"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Atendida'">
                        <div layout="row">
                            <span translate>REQUESTS.LIST.ATTENDED</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Atendida"></div>
                        </div>
                    </div>
                    <div layout="colum" layout-align="center center" ng-if="vm.request.status == 'Cancelada'">
                        <div layout="row">
                            <span translate>REQUESTS.LIST.CANCELED</span>&nbsp
                        </div>
                        <div layout="row">
                            <div class="Cancelada"></div>
                        </div>
                    </div>
                </div>
            </div>
        </md-content>

    </md-card>

    <md-card
        layout="column"
        layout-align="center stretch"
        cg-busy="{promise:vm.storeLoading,templateUrl:'app/mainApp/directives/loading_repeater.tmpl.html',wrapperClass:'cg-busy cg-busy-animation'}"
        layout-padding>
        <h3 translate>SALEPOINT_REQUEST.ASSIGN_DETAIL.STORE</h3>

        <store-manager
            store="vm.store"
        ></store-manager>

    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             layout-padding>
        <h3 translate>REQUESTS.DETAIL.EVIDENCES</h3>

        <div
            layout="column"
            layout-align="space-around center">

            <div ng-if="vm.request.evidencia.length>0" layout-fill>

                <ng-image-gallery
                    images="vm.request.evidencia"
                    thumbnails="false"
                    thumb-size="80"
                    inline="true"
                    bubbles="true"
                    bubble-size="5"
                    img-bubbles="true"
                    bg-close="false"
                    piracy="false"
                    img-anim="fadeup"
                ></ng-image-gallery>
                <!--<img ng-repeat="evidence in vm.request.evidencia" ngf-src="evidence.foto" class="thumbnails" layout-padding/>-->
            </div>

            <div ng-if="vm.request.evidencia.length===0">
                <p>{{'REQUESTS.DETAIL.NO_EVIDENCES'|translate}}</p>
            </div>
        </div>
    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             layout-padding>
        <h3 translate>Servicio</h3>

        <md-input-container class="md-block">
            <input ng-model="vm.servicio.km" type="number" placeholder="km (required)" ng-required="true" md-maxlength="4">
        </md-input-container>

        <md-input-container class="md-block"
                            ng-if="vm.request.tipo === 'Baja' || vm.request.tipo === 'Cambio' || vm.request.tipo === 'Medio'"
                            layout-padding>

            <div layout="colum" layout-align="left center" ng-if="vm.request.tipo === 'Baja'">
                Retirar Cabinet:&nbsp
            </div>

            <div layout="colum" layout-align="left center" ng-if="vm.request.tipo === 'Cambio'">
                Cambiar Cabinet:&nbsp
            </div>

            <div layout="colum" layout-align="left center" ng-if="vm.request.tipo === 'Medio'">
                Servicio Técnico al Cabinet:&nbsp
            </div>
            <input ng-model="vm.solicitudDetalles.cabinet" readonly>

        </md-input-container>

        <div layout-align="left center" ng-if="vm.request.tipo === 'Medio' && vm.visible">

            <div layout="column" layout-align="center center">
                <h3><b translate>Insumos</b></h3>
                <md-switch ng-click="vm.changeProductivo()">Improductivo</md-switch>
            </div>

            <div>
                <md-list md-invert ng-repeat="insumo in vm.insumos.results" ng-if="vm.improductivo">
                    <div column>
                        <div layout="row" layout-align="center center">
                            <div flex="50">
                                <md-switch value="insumo.id" ng-click="vm.insumoSelect(insumo)">{{insumo.descripcion}}</md-switch>
                            </div>

                            <div layout="column" flex>
                            </div>

                            <div ng-click="vm.validaMax(insumo)" ng-if="insumo.check == true">
                                <md-input-container ng-if="insumo.insumoMax > 0">
                                    <div range-spinner
                                         range-min="1"
                                         range-step="1"
                                         range-max="{{insumo.insumoMax}}"
                                         range-decimal-precision="1"
                                         range-default-value="1"
                                         range-model="insumo.usado"
                                         accept-decimal="false"
                                         id-of-field="rangeFieldId">
                                    </div>

                                </md-input-container>
                                <div ng-if="insumo.error">
                                    <span style="color: #FF1B28;"> <b translate>MAIN.GENERAL.MAX </b><b>{{insumo.insumoMax}}</b></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </md-list>
            </div>
        </div>

        <div layout-align="center stretch"
             layout="column"
             layout-padding>
                 <!--ng-if="vm.request.tipo === 'Alta' || vm.request.tipo === 'Cambio'">-->

            <div ng-if="vm.solicitudDetalles.solicitudes_cabinet.length > 0" flex class="md-block">
                <table md-table flex>
                    <thead md-head>
                    <tr md-row>
                        <th md-column>
                            <span translate>REQUESTS.NEW.CABINETS.KIND</span>
                        </th>
                        <th md-column>
                            <span translate>REQUESTS.NEW.CABINETS.QUANTITY</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody md-body>
                    <tr md-row
                        ng-repeat="cabinet in vm.solicitudDetalles.solicitudes_cabinet">
                        <td md-cell>{{cabinet.tipo}}</td>
                        <td md-cell>{{cabinet.cantidad}}</td>
                    </tr>
                    </tbody>
                </table>


            </div>

        </div>

    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             ng-if="vm.request.tipo && vm.visible"
             layout-padding>
        <div flex
             layout="row"
             layout-align-gt-sm="space-around center">
            <h3 translate>REQUESTS.NEW.EVIDENCES</h3>
        </div>
        <file-uploader file-formats="'image/*'"
                       validations="vm.fileValidations"
                       allow-folders="true"
                       max-files="5"
                       multiple-files="true"
                       keep="true"
                       files-selected="vm.filesSelected(files)"
        ></file-uploader>
    </md-card>

    <md-card layout-align="center stretch"
             layout="column"
             ng-if="vm.request.tipo"
             layout-padding>
        <div flex
             layout="row"
             layout-align-gt-sm="space-around center">
            <h3 translate>Información de la atención</h3>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">
            <md-input-container flex class="md-block">
                <label translate>REQUESTS.NEW.CLIENT_COMMENTS</label>
                <input
                    ng-model="vm.request.observaciones_cliente"
                    readonly="vm.visible"/>
            </md-input-container>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">
            <md-input-container flex class="md-block">
                <label translate>REQUESTS.NEW.WORKER_COMMENTS</label>
                <input
                    ng-model="vm.request.observaciones_tecnico"
                    readonly="vm.visible"/>
            </md-input-container>
        </div>
        <div flex
             layout="column"
             layout-gt-sm="row"
             layout-align-gt-sm="center stretch">

            <md-input-container flex class="md-block">
                <label translate>REQUESTS.NEW.SCORE</label>
                <md-select
                    ng-model="vm.request.calificacion" disabled="vm.visible">
                    <md-option
                        ng-repeat="score in vm.scores"
                        ng-value="score.value">
                        {{score.label}}
                    </md-option>
                </md-select>
            </md-input-container>
        </div>

        <div layout="row"
             layout-align="end end"
             layout-sm="column"
             layout-xs="column"
             layout-align-sm="start stretch"
             layout-align-xs="start stretch"
             ng-if="vm.visible">
            <md-button
                cg-busy="{promise:vm.savingPromise, message:''}"
                aria-label="assign" ng-click="vm.save()"
                class="md-raised md-primary">
                <md-icon md-font-icon="fa fa-save"></md-icon>
            </md-button>
        </div>

    </md-card>


</div>
